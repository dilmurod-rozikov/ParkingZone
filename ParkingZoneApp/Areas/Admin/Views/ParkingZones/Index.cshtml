@using ParkingZoneApp.Enums
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model IEnumerable<ParkingZoneApp.ViewModels.ParkingZoneVMs.ListItemVM>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1 style="font-family: Bahnschrift">List of all ParkingZones</h1>

<p style="font-family: Bahnschrift">
    <a asp-action="Create" class="btn btn-primary">Create New</a>
</p>

<style>
    .crazy-card {
        color: #fff;
        border: 2px solid #fff;
        width: 70%;
        font-size: 25px;
        font-family: Bahnschrift;
        margin: auto;
        border-radius: 15px;
        overflow: hidden;
    }

    .crazy-card-header {
        display: flex;
        justify-content: space-between;
        background-color: #008080;
        padding: 15px;
        border-bottom: 2px solid #fff;
    }

    .crazy-card-body {
        background-color: #000;
        padding: 10px;
    }
</style>
@foreach (var item in Model)
{
    <div class="crazy-card">
        <div class="crazy-card-body">
                <h3>@Html.DisplayFor(modelItem => item.Name)</h3>
            <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-outline-warning">Edit</a>
            <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-outline-primary">Details</a>
            <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-outline-danger">Delete</a>
            <a asp-controller="ParkingSlot" asp-action="Index" asp-route-zoneId="@item.Id" class="btn btn-outline-light">Slots</a>
            <a asp-action="GetCurrentCars" asp-route-zoneId="@item.Id" class="btn btn-outline-success">Current Cars</a>
        </div>
        <div class="crazy-card-header">
            <div>
                <p>Address: @Html.DisplayFor(modelItem => item.Address)</p>
                <p>Created On: @Html.DisplayFor(modelItem => item.CreatedDate)</p>
                <p>Available Slots: @item.NumberOfSlots</p>
                <p>Slots in use: @item.SlotInUse</p>
            </div>
            <div class="finance-block" style="margin-right: 50px">
                <div class="zone-block" id="zone-block_@item.Id">
                    <label>Choose period range</label>
                    <select class="form-select" style="width:180px" asp-items="@(Html.GetEnumSelectList<PeriodRange>())">
                        <option>Not chosen</option>
                    </select>
                    <div>
                        @foreach (var category in Enum.GetValues(typeof(SlotCategory)))
                        {
                            <p>@category : <label style="color: darkgoldenrod" class="@category-placeholder">0</label> hours reserved.</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br />
}
<script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-3.5.1.min.js"></script>
<script>
    $(document).ready(function () {
        $('.finance-block select').change(function () {
            var selectedPeriod = $(this).val();
            var zoneId = $(this).closest(".zone-block").attr("id").split("_")[1];
            var $this = $(this);

            $.ajax({
                type: 'GET',
                url: '@Url.Action("FilterByPeriod", "ParkingZones")',
                data: { zoneId: zoneId, periodRange: selectedPeriod },
                success: function (data) {
                    Object.keys(data.categoryHours).forEach(function (key) {
                        var value = data.categoryHours[key];
                        var financeBlock = $this.closest(".finance-block");
                        var placeholderClass = "." + key + "-placeholder";
                        var placeholderElement = financeBlock.find(placeholderClass);
                        placeholderElement.text(value);
                    });
                },
                error: function (xhr, status, error) {
                    console.log("zoneId:", zoneId);
                    console.log("periodRange:", selectedPeriod);
                    alert('Error fetching data.');
                }
            });
        });
    });

</script>